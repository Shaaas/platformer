<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Platformer with Levels</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #87ceeb;
    font-family: Arial, sans-serif;
  }
  canvas {
    display: block;
    background: #87ceeb;
  }
  #restartBtn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 10px 20px;
    font-size: 20px;
    display: none;
    cursor: pointer;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="400"></canvas>
<button id="restartBtn">Restart</button>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const restartBtn = document.getElementById('restartBtn');

const gravity = 0.5;
const player = {x:50, y:300, width:30, height:50, color:'red', dx:0, dy:0, speed:5, jumpPower:12, onGround:false};
let score = 0;
let gameOver = false;
let currentLevel = 0;

// Levels data
const levels = [
  {
    platforms: [
      {x:0, y:350, width:800, height:50},
      {x:200, y:250, width:100, height:10},
      {x:400, y:180, width:150, height:10},
      {x:650, y:300, width:100, height:10}
    ],
    collectibles: [
      {x:220, y:220, width:20, height:20, color:'gold', collected:false},
      {x:450, y:150, width:20, height:20, color:'gold', collected:false},
      {x:670, y:270, width:20, height:20, color:'gold', collected:false}
    ],
    enemies: [
      {x:300, y:320, width:30, height:30, color:'purple', dx:2, leftBound:300, rightBound:400}
    ],
    endX: 750 // x position to reach next level
  },
  {
    platforms: [
      {x:0, y:350, width:800, height:50},
      {x:150, y:280, width:120, height:10},
      {x:350, y:200, width:180, height:10},
      {x:600, y:150, width:150, height:10}
    ],
    collectibles: [
      {x:170, y:250, width:20, height:20, color:'gold', collected:false},
      {x:380, y:170, width:20, height:20, color:'gold', collected:false},
      {x:650, y:120, width:20, height:20, color:'gold', collected:false}
    ],
    enemies: [
      {x:200, y:320, width:30, height:30, color:'purple', dx:1.5, leftBound:200, rightBound:300},
      {x:400, y:170, width:30, height:30, color:'purple', dx:2, leftBound:400, rightBound:520}
    ],
    endX: 750
  }
];

let platforms = [];
let collectibles = [];
let enemies = [];

function loadLevel(levelIndex){
  const level = levels[levelIndex];
  platforms = JSON.parse(JSON.stringify(level.platforms));
  collectibles = JSON.parse(JSON.stringify(level.collectibles));
  enemies = JSON.parse(JSON.stringify(level.enemies));
  player.x = 50;
  player.y = 300;
  player.dx = 0;
  player.dy = 0;
  player.onGround = false;
  gameOver = false;
  restartBtn.style.display = 'none';
}

loadLevel(currentLevel);

const keys = {};
document.addEventListener('keydown', e => keys[e.code] = true);
document.addEventListener('keyup', e => keys[e.code] = false);

function update(){
  if(gameOver) return;

  // Player movement
  if(keys['ArrowLeft']||keys['KeyA']) player.dx = -player.speed;
  else if(keys['ArrowRight']||keys['KeyD']) player.dx = player.speed;
  else player.dx = 0;

  if((keys['ArrowUp']||keys['KeyW']||keys['Space']) && player.onGround){
    player.dy = -player.jumpPower;
    player.onGround = false;
  }

  player.dy += gravity;
  player.x += player.dx;
  player.y += player.dy;

  // Platform collision
  player.onGround = false;
  for(let plat of platforms){
    if(player.x < plat.x + plat.width &&
       player.x + player.width > plat.x &&
       player.y + player.height < plat.y + plat.height &&
       player.y + player.height > plat.y){
      player.y = plat.y - player.height;
      player.dy = 0;
      player.onGround = true;
    }
  }

  // Keep player in canvas
  if(player.x < 0) player.x = 0;
  if(player.x + player.width > canvas.width) player.x = canvas.width - player.width;
  if(player.y + player.height > canvas.height){
    player.y = canvas.height - player.height;
    player.dy = 0;
    player.onGround = true;
  }

  // Collectibles
  for(let item of collectibles){
    if(!item.collected &&
       player.x < item.x + item.width &&
       player.x + player.width > item.x &&
       player.y < item.y + item.height &&
       player.y + player.height > item.y){
      item.collected = true;
      score += 1;
    }
  }

  // Enemy movement & collision
  for(let enemy of enemies){
    enemy.x += enemy.dx;
    if(enemy.x < enemy.leftBound || enemy.x + enemy.width > enemy.rightBound) enemy.dx *= -1;

    if(player.x < enemy.x + enemy.width &&
       player.x + player.width > enemy.x &&
       player.y < enemy.y + enemy.height &&
       player.y + player.height > enemy.y){
      gameOver = true;
      restartBtn.style.display = 'block';
    }
  }

  // Check level completion
  if(player.x >= levels[currentLevel].endX){
    currentLevel++;
    if(currentLevel >= levels.length){
      alert('You Win! Final Score: ' + score);
      currentLevel = 0;
    }
    loadLevel(currentLevel);
  }
}

function draw(){
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Player
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.width, player.height);

  // Platforms
  ctx.fillStyle = 'green';
  for(let plat of platforms){
    ctx.fillRect(plat.x, plat.y, plat.width, plat.height);
  }

  // Collectibles
  for(let item of collectibles){
    if(!item.collected){
      ctx.fillStyle = item.color;
      ctx.fillRect(item.x, item.y, item.width, item.height);
    }
  }

  // Enemies
  for(let enemy of enemies){
    ctx.fillStyle = enemy.color;
    ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
  }

  // Score
  ctx.fillStyle = 'black';
  ctx.font = '20px Arial';
  ctx.fillText('Score: ' + score, 10, 30);

  // Game Over
  if(gameOver){
    ctx.fillStyle = 'black';
    ctx.font = '40px Arial';
    ctx.fillText('GAME OVER', 300, 200);
  }
}

restartBtn.addEventListener('click', () => {
  loadLevel(currentLevel);
});

function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
